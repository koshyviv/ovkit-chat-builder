# Stage 1: Build the NVIDIA web-viewer-sample to extract dependencies
FROM node:18 as nvidia-deps-builder
WORKDIR /nvidia-build

# Clone the repository
RUN git clone https://github.com/NVIDIA-Omniverse/web-viewer-sample.git .

# Install dependencies - this will fetch the private package
RUN npm install

# Stage 2: Build the main application using the previously fetched dependencies
FROM node:18 as app
WORKDIR /app

# Copy package files
COPY package.json package-lock.json ./

# Copy the node_modules from the first stage that contains the NVIDIA library
COPY --from=nvidia-deps-builder /nvidia-build/node_modules/@nvidia /app/node_modules/@nvidia

# Install the rest of our dependencies
RUN npm install

# Copy the rest of the application
COPY . .

# Development server runs on port 8080
EXPOSE 8080

# Command is specified in docker-compose.yml 